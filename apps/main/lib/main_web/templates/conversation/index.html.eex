<header class="section-menu nav-scroller">
    <!-- .nav-tabs -->
    <ul class="nav nav-tabs card-header-tabs">
        <li class="nav-item">
            <a class="nav-link active show" data-toggle="tab" href="#project-assigned">Me (<%= Enum.count(@conversations, &(&1.team_member_id == assigns[:current_user].id)) %>)</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" data-toggle="tab" href="#project-open">Open (<%= Enum.count(@conversations, fn(c) -> c.status == "open" end) %>)</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" data-toggle="tab" href="#project-closed">Closed (<%= Enum.count(@conversations, fn(c) -> c.status == "closed" end) %>)</a>
        </li>
    </ul><!-- /.nav-tabs -->
</header>

<header class="page-title-bar">
    <div class="d-flex justify-content-between">
        <div class="input-group has-clearable message-search">
            <div class="input-group-prepend">
                <span class="input-group-text"><span class="oi oi-magnifying-glass"></span></span>
            </div>
            <input type="text" class="form-control" placeholder="Search message">
            <div class="input-group-append">
                <div class="dropdown">
                    <button class="btn btn-secondary" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Last updated <span class="fa fa-caret-down"></span></button>
                    <div class="dropdown-arrow"></div><!-- .dropdown-menu -->
                    <div class="dropdown-menu dropdown-menu-right stop-propagation">
                        <h6 class="dropdown-header"> Sort By </h6>
                        <label class="custom-control custom-radio"><input type="radio" class="custom-control-input" name="sortTeamsBy" value="0"> <span class="custom-control-label">Name</span></label>
                        <label class="custom-control custom-radio"><input type="radio" class="custom-control-input" name="sortTeamsBy" value="1"> <span class="custom-control-label">Name <span class="text-muted">(Decs)</span></span></label>
                        <label class="custom-control custom-radio"><input type="radio" class="custom-control-input" name="sortTeamsBy" value="2" checked=""> <span class="custom-control-label">Last updated</span></label>
                        <label class="custom-control custom-radio"><input type="radio" class="custom-control-input" name="sortTeamsBy" value="3"> <span class="custom-control-label">Oldest updated</span></label>
                        <label class="custom-control custom-radio"><input type="radio" class="custom-control-input" name="sortTeamsBy" value="4"> <span class="custom-control-label">Last created</span></label>
                        <label class="custom-control custom-radio"><input type="radio" class="custom-control-input" name="sortTeamsBy" value="5"> <span class="custom-control-label">Oldest created</span></label>
                    </div><!-- /.dropdown-menu -->
                </div><!-- /.dropdown -->
            </div>
        </div><!-- /.input-group -->
        &nbsp;
        <%= if assigns[:current_user].role == "admin" do %>â€¨
            <a href="<%= team_location_conversation_path(@conn, :new, @location.team_id, @location.id) %>" class="btn btn-primary">
                <i class="fas fa-plus">&nbsp;</i> 
                New Message
            </a>
        <% end %>
    </div>
</header>

<div class="page-section">
    <section class="card card-fluid">
        <div class="text-muted px-3 mb-2"></div>

        <div class="tab-content">

            <div class="tab-pane fade active show" id="project-assigned" role="tabpanel" aria-labelledby="project-assigned-tab">
                <!-- .list-group-item -->
                <%= if Enum.count(@conversations, &(&1.team_member_id == assigns[:current_user].id)) == 0 do %>
                    <div class="alert alert-info mx-3">You have no assigned conversations for this location</div>
                <% end %>

                <table class="table no-first-border">
                    <tbody>
                    <%= for c <- Enum.filter(@conversations, &(&1.team_member_id == assigns[:current_user].id)) do %>
                        <%= render("_conversation_row.html", c: c, conn: @conn, location: @location) %>
                    <% end %>
                    </tbody>
                </table>
            </div>

            <div class="tab-pane fade" id="project-open" role="tabpanel" aria-labelledby="project-open-tab">
                <%= if Enum.count(@conversations, &(&1.status == "open")) == 0 do %>
                    <div class="alert alert-info mx-3">There are no open conversations for this location.</div>
                <% end %>

                <table class="table no-first-border">
                    <tbody>
                    <%= for c <- Enum.filter(@conversations, &(&1.status == "open")) do %>
                        <%= render("_conversation_row.html", c: c, conn: @conn, location: @location) %>
                    <% end %>
                    </tbody>
                </table>
            </div>

            <div class="tab-pane fade" id="project-closed" role="tabpanel" aria-labelledby="project-closed-tab">
                <%= if Enum.count(@conversations, &(&1.status == "closed")) == 0 do %>
                    <div class="alert alert-info mx-3">There are no closed conversations for this location.</div>
                <% end %>

                <table class="table no-first-border">
                    <tbody>
                        <%= for c <- Enum.filter(@conversations, &(&1.status == "closed")) do %>
                            <% team_member = (c.team_member || default_user()) %>
                            <%= render("_conversation_row.html", c: c, conn: @conn, location: @location) %>
                        <% end %>
                    </tbody>
                </table>
            </div>

        </div>

    </section>
</div>
