<header id="conversation-tabs" class="section-menu nav-scroller">
    <!-- .nav-tabs -->
    <ul class="nav nav-tabs card-header-tabs">
        <li class="nav-item">

            <a class="nav-link" data-toggle="tab" href="#project-assigned">Me (<%= Enum.count(@my_conversations, &(&1.status in ["open", "pending"])) %>)</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" data-toggle="tab" href="#project-open"><%= live_render(@conn, MainWeb.Live.OpenConverationsView, session: %{"location_id" => @location.id, "header" => true},id: @user.id) %></a>
        </li>
        <li class="nav-item">
            <a class="nav-link" data-toggle="tab" href="#project-closed">Closed (<%= Enum.count(@conversations, fn(c) -> c.status == "closed" end) %>)</a>
        </li>
    </ul>
    <!-- /.nav-tabs -->

    <script>
        // this is not good but it is a quick win.
        $("#conversation-tabs .nav-item").click(function (e) {
            window.localStorage.setItem("conversation-tab-sticky", $($(e.target).closest(".nav-item")).index());
        });
        var stickyTabIndex = window.localStorage.getItem("conversation-tab-sticky");
        if (stickyTabIndex) {
            stickyTabIndex = parseInt(stickyTabIndex, 10);
            setTimeout(function() {
                $("#conversation-tabs .nav-item").eq(stickyTabIndex).find(".nav-link").click();
            }, 100);
        } else {
            $("#conversation-tabs .nav-item").eq(0).find(".nav-link").click();
        }
    </script>
</header>

<header class="page-title-bar">
    <div class="d-flex justify-content-between">
        &nbsp;
        <%= if @user.role in ["admin", "team-admin", "location-admin"] do %>â€¨
            <a href="<%= team_location_conversation_path(@conn, :new, @location.team_id, @location.id) %>" class="btn btn-primary">
                <i class="fas fa-plus">&nbsp;</i>
                New Message
            </a>
        <% end %>
    </div>
</header>

<div class="page-section">
    <section class="card card-fluid">
        <div class="text-muted px-3 mb-2"></div>

        <div class="tab-content">

            <div class="tab-pane fade" id="project-assigned" role="tabpanel" aria-labelledby="project-assigned-tab">
                <!-- .list-group-item -->
                <%= if Enum.count(@my_conversations) == 0 do %>
                    <div class="alert alert-info mx-3">You have no assigned conversations for this location</div>
                <% end %>

                <table class="table no-first-border">
                    <tbody>
                        <%= for c <- @my_conversations do %>
                            <%= render("_conversation_row.html", c: c, conn: @conn, location: @location, dispositions: @dispositions) %>
                        <% end %>
                    </tbody>
                </table>
            </div>

            <div class="tab-pane fade" id="project-open" role="tabpanel" aria-labelledby="project-open-tab">
                <%= if Enum.count(@conversations, &(&1.status in ["open", "pending"])) == 0 do %>
                    <div class="alert alert-info mx-3">There are no open conversations for this location.</div>
                <% end %>

                <table class="table no-first-border">
                    <tbody>
                        <%= for c <- Enum.filter(@conversations, &(&1.status in ["open", "pending"])) do %>
                            <%= render("_conversation_row.html", c: c, conn: @conn, location: @location, dispositions: @dispositions) %>
                        <% end %>
                    </tbody>
                </table>
            </div>

            <div class="tab-pane fade" id="project-closed" role="tabpanel" aria-labelledby="project-closed-tab">
                <%= if Enum.count(@conversations, &(&1.status == "closed")) == 0 do %>
                    <div class="alert alert-info mx-3">There are no closed conversations for this location.</div>
                <% end %>

                <table class="table no-first-border">
                    <tbody>
                        <%= for c <- Enum.filter(@conversations, &(&1.status == "closed")) do %>
                            <%= render("_conversation_row.html", c: c, conn: @conn, location: @location, dispositions: @dispositions) %>
                        <% end %>
                    </tbody>
                </table>
            </div>

        </div>

    </section>
</div>
