<%= if @loading == true do %>
  <div id="loading">
      <div class="lds-facebook"><div></div><div></div><div></div></div>
  </div>

<% end %>

<div class="page has-sidebar has-sidebar-fluid has-sidebar-expand-xl">
    <!-- Message List -->
    <div class="page-inner page-inner-fill position-relative">
        <header class="page-navs bg-white shadow-sm d-flex justify-content-between px-2">
            <div class="btn btn-light btn-icon ">
                <i class="fa fa-search"></i>
            </div>
            <%= text_input :f, :filter_text, class: "form-control", phx_keyup: "filter_convo"%>
        </header>
        <div class="">
            <button type="button" class="btn btn-primary btn-floated position-absolute" data-toggle="modal"
                    data-target="#newMsg" title="Add New Message"><i class="fa fa-plus"></i></button>
        </div>

        <div class="board p-0 perfect-scrollbar ps ps--active-y">
            <!-- .list-group -->
            <div class="list-group list-group-flush list-group-divider border-top" data-toggle="radiolist">
                <!-- .list-group-item -->
                <%= for c <- @conversations do %>
                <div class="list-group-item <%=  if c.id == @open_conversation.id,do: "active",else: ""  %>" phx-click="openconvo" phx-value-cid="<%= c.id %>">
                    <div class="list-group-item-figure">
                        <%=  if c.channel_type == "WEB" do  %>
                        <a href="#" class="tile tile-circle bg-pink"><i class="fab fa-chrome"></i></a>
                        <% end %>
                        <%=  if c.channel_type == "FACEBOOK" do  %>
                        <a href="#" class="tile tile-circle bg-blue"><i class="fab fa-facebook-f"></i></a>
                        <% end %>
                        <%=  if c.channel_type == "SMS" do  %>
                        <a href="#" class="tile tile-circle bg-purple"><i class="fas fa-sms"></i></a>
                        <% end %>
                        <%=  if c.channel_type == "APP" do  %>
                        <a href="#" class="tile tile-circle bg-yellow"><i class="fas fa-mobile"></i></a>
                        <% end %>
                    </div>
                    <div class="list-group-item-body">
                        <h4 class="list-group-item-title font-weight-bold">
                            <a href="#">
                                <%= if c.member && c.member.first_name do %>
                                    <%= Enum.join([c.member.first_name, c.member.last_name], " ") %>
                                <% else %>
                                    <%= format_phone(c.original_number) %>
                                <% end %>
                            </a>
                        </h4>
                        <p class="list-group-item-text"> <%= c.location.location_name %> </p>
                    </div>
                    <%= if !c.team_member || c.status == "closed" do %>
                        <div class="list-group-item-figure">
                            <button class="btn btn-sm btn-icon text-white bg-success" phx-click="assign" phx-value-cid="<%= c.id %>"><i class="fas fa-check"></i></button>
                        </div>
                    <% end %>


                </div>
                <% end %>

            </div><!-- /.list-group -->
            <div class="ps__rail-x" style="left: 0px; bottom: 0px;">
                <div class="ps__thumb-x" tabindex="0" style="left: 0px; width: 0px;"></div>
            </div>
            <div class="ps__rail-y" style="top: 0px; height: 454px; right: 0px;">
                <div class="ps__thumb-y" tabindex="0" style="top: 0px; height: 194px;"></div>
            </div>
        </div><!-- /board -->
    </div>
    <!-- Conversation Window -->


    <div class="page-sidebar bg-light">
        <div class="row m-0">
            <!--Message Window-->
            <%= if assigns[:open_conversation]  do %>
            <div class="sidebar-section sidebar-section-fill page-inner-fill col-lg-8 p-0">
                <!-- .message -->
                <div class="message m-0" style="top:0 !important;">
                    <!-- message header -->
                    <div class="message-header p-3 bg-white shadow-sm">
                        <a href="#" class="btn-account" role="button">
                            <span class="user-avatar user-avatar-md">
                                <img src="/images/unknown-profile.jpg">
                            </span>
                            <span class="account-summary"><span class="account-name">
                                 <%= if @open_conversation.member && @open_conversation.member.first_name do %>
                                <%= Enum.join([@open_conversation.member.first_name, @open_conversation.member.last_name], " ") %>
                                <% else %>
                                <%= format_phone(@open_conversation.original_number) %>
                                <% end %>
                            </span>
                                <span class="account-description"><%= if assigns[:online] do %>
                <span class="indicator online"></span>
                <% else %>
                <span class="indicator offline"></span>
                <% end %><span>
                                    <%= if @open_conversation.team_member do %>
                                      | Assigned to <%= @open_conversation.team_member.user.first_name %> <%= @open_conversation.team_member.user.last_name %>
                                    <% end %>
                                </span></span></span></a>
                        <div class="message-header-actions">

                            <!-- assign conversation -->
                            <div class="dropdown d-inline-block">
                                <button type="button" class="btn btn-light btn-icon" title="Invite members"
                                        data-toggle="dropdown" data-display="static" aria-haspopup="true"
                                        aria-expanded="false"><span class="oi oi-person"></span></button>
                                <!-- .dropdown-menu -->
                                <div class="dropdown-menu dropdown-menu-right dropdown-menu-rich stop-propagation">
                                    <%= f = form_for :foo, "#", [ phx_submit: :assign] %>
                                    <div class="dropdown-arrow"></div>
                                    <div class="dropdown-header"> Assign to a Teammate</div>
                                    <div class="form-group px-3 py-2 m-0">
                                        <%= select f, :team_member_id, @team_members_all, selected: @open_conversation.team_member_id||"",prompt: "Select Team Member", class: "custom-select"  %>
                                    </div>
                                    <div id="people" class="tribute-inline stop-propagation"></div>
                                    <button type="submit">Assign <span class="oi oi-person"></span></button>
                                    </form>
                                </div><!-- /.dropdown-menu -->
                            </div><!-- / assign conversation -->
                            <!-- close dispositions -->
                            <div class="dropdown d-inline-block">
                                <button type="button" class="btn btn-light btn-icon" title="Close Conversation"
                                        data-toggle="dropdown" data-display="static" aria-haspopup="true"
                                        aria-expanded="false"><i class="fas fa-archive"></i></button>
                                <!-- .dropdown-menu -->
                                <div class="dropdown-menu dropdown-menu-right dropdown-menu-rich stop-propagation">
                                    <div class="dropdown-arrow"></div>
                                    <div class="dropdown-header"> Close Conversation</div>

                                    <div class="form-group px-3 py-2 m-0">
                                        <label class="control-label" for="select2-single">Please select one to
                                            continue</label>
                                        <select id="select2-single"
                                                class="form-control select2-hidden-accessible"
                                                data-toggle="select2"
                                                data-placeholder="Select a Disposition"
                                                data-allow-clear="true"
                                                data-select2-id="select2-single" tabindex="-1"
                                                aria-hidden="true">
                                            <%= for {key, value} <- @dispositions do %>
                                            <option value="<%= value %>" data-select2-id="<%= value %>"
                                                    phx-click="close" phx-value-did="<%= value %>"
                                                    phx-value-cid="<%= @open_conversation.id %>"><%= key %></option>
                                            <% end %>

                                        </select>
                                    </div>


                                    <div id="people" class="tribute-inline stop-propagation"></div>
                                    <a href="#" class="dropdown-footer">Close <span class="oi oi-transfer"></span></a>
                                </div><!-- /.dropdown-menu -->
                            </div><!-- / close dispositions -->


                            <button type="button" class="btn btn-light btn-icon d-xl-none" data-toggle="sidebar"><i
                                    class="fa fa-angle-double-left"></i></button>
                        </div>
                    </div><!-- /message header -->
                    <!-- message body -->
                    <div class="message-body p-0 border-top">
                        <!-- .card -->
                        <div class="card card-fluid mb-0 m-3">
                            <!-- .conversations -->
                            <div role="log" class="conversations">
                                <!-- .conversation-list -->
                                <ul class="conversation-list">
                                    <!-- .conversation-divider -->
                                    <li class="log-divider">
                                        <span>
                                        <i class="far fa-fw fa-comment-alt"></i> Conversation started by
                                        <strong>
                                            <%= if @open_conversation.member && @open_conversation.member.first_name do %>
                                                 <%= Enum.join([@open_conversation.member.first_name, @open_conversation.member.last_name], " ") %>
                                            <% else %>
                                                <%= format_phone(@open_conversation.original_number) %>
                                            <% end %>
                                        </strong> ·
                                            <%= format_date(@open_conversation.started_at) %> </span>
                                    </li><!-- /.conversation-divider -->
                                    <%= for {message, index} <- Enum.with_index(@open_conversation.conversation_messages)|>Enum.reverse() do %>
                                        <% previous_message = Enum.at(@open_conversation.conversation_messages, index-1) %>
                                        <% next_message = Enum.at(@open_conversation.conversation_messages, index+1) %>
                                        <% member_name = if @open_conversation.member, do: [@open_conversation.member.first_name, @open_conversation.member.last_name] |> Enum.join(" "), else: " " %>

                                    <%= if message.phone_number == @open_conversation.original_number do %>
                                    <%= if previous_message && message.phone_number == previous_message.phone_number do %>
                                    <li class="conversation-inbound conversation-faux">
                                        <div class="conversation-message ">
                                            <div class="conversation-message-text"><%= text_to_html(message.message) |> raw %></div>
                                            <%= if next_message && next_message.phone_number != message.phone_number do %>
                                            <div class="conversation-meta">
                                                <%= if member_name != " ", do: member_name, else: "#{format_phone(message.phone_number)}" %>
                                                ·
                                                <%= format_date(message.sent_at) %>
                                            </div>
                                            <% end %>
                                        </div>
                                    </li>
                                    <% else %>
                                    <li class="conversation-inbound">
                                        <div class="conversation-message">
                                            <div class="conversation-message-text"> <%= text_to_html(message.message) |> raw %></div>
                                            <%= if next_message && next_message.phone_number != message.phone_number do %>
                                            <div class="conversation-meta">
                                                <%= if member_name != " ", do: member_name, else: "#{format_phone(message.phone_number)}" %>
                                                ·
                                                <%= format_date(message.sent_at) %>
                                            </div>
                                            <% end %>
                                        </div>
                                    </li>
                                    <% end %>

                    <% else %>
                                    <%= cond do %>
                            <% String.contains?(message.message, "OPENED") -> %>
                                    <li class="log-divider">
                                    <span>
                                        <i class="fa fa-fw fa-user-plus"></i>
                                        Conversation <%= String.replace(message.message, "OPENED:", "") %> · <%= format_date(message.sent_at) %>
                                    </span>
                                    </li>
                                    <% String.contains?(message.message, "CLOSED") -> %>
                                    <li class="log-divider">
                                    <span>
                                        <i class="fa fa-fw fa-user-plus"></i>
                                        Conversation <%= String.replace(message.message, "CLOSED:", "") %> · <%= format_date(message.sent_at) %>
                                    </span>
                                    </li>
                                    <% String.contains?(message.message, "ASSIGNED") -> %>
                                    <li class="log-divider">
                                    <span>
                                        <i class="fa fa-fw fa-user-plus"></i>
                                        <%= String.replace(message.message, "ASSIGNED:", "") %> · <%= format_date(message.sent_at) %>
                                    </span>
                                    </li>
                                    <% true -> %>
                                    <%= if previous_message && message.phone_number != previous_message.phone_number do %>
                                    <li class="conversation-outbound conversation-faux">
                                        <div class="conversation-message ">
                                            <%= if format_phone(@open_conversation.original_number) == "Unknown Visitor" do %>
                                            <div class="conversation-message-text"><%= message.message |> raw %></div>
                                            <% else %>
                                            <div class="conversation-message-text"><%= text_to_html(message.message) |> raw %></div>
                                            <% end %>
                                            <%= if is_nil(next_message) || next_message.phone_number != message.phone_number do %>
                                            <div class="conversation-meta">
                                                <%= if message.phone_number == @open_conversation.location.phone_number do %>
                                                <%= format_assigned(@open_conversation.original_number) %>
                                                    <% else %>
                                                <%= format_phone(message.phone_number) %>
                                                    <% end %>
                                                ·
                                                <%= format_date(message.sent_at) %>
                                                <%= if message.read && @open_conversation.channel_type=="APP" do %>
                                                <i class="fa fa-check" style="color: green"></i>
                                                <i class="fa fa-check" style="color: green"></i>
                                                <% end %>
                                            </div>
                                            <% else %>
                                            <%= if message.read && @open_conversation.channel_type=="APP" do %>
                                            <div class="conversation-meta">

                                                <i class="fa fa-check" style="color: green"></i>
                                                <i class="fa fa-check" style="color: green"></i>
                                            </div>
                                            <% end %>
                        <% end %>
                                        </div>
                                    </li>
                                    <% else %>
                                    <li class="conversation-outbound">
                                        <div class="conversation-message">
                                            <div class="conversation-message-text"> <%= text_to_html(message.message) |> raw %></div>
                                            <%= if is_nil(next_message) || next_message.phone_number != message.phone_number do %>
                                            <div class="conversation-meta">
                                                <%= if message.phone_number == @open_conversation.location.phone_number do %>
                                                <%= format_assigned(@open_conversation.original_number) %>
                                                    <% else %>
                                                <%= format_phone(message.phone_number) %>
                                                    <% end %>
                                                ·
                                                <%= format_date(message.sent_at) %>
                                                <%= if message.read && @open_conversation.channel_type=="APP" do %>
                                                <i class="fa fa-check" style="color: green"></i>
                                                <i class="fa fa-check" style="color: green"></i>
                                                <% end %>

                                            </div>
                                            <% else %>
                                            <div class="conversation-meta">
                                                <% team_member = Enum.find(@team_members, &(&1.user.phone_number == message.phone_number)) %>
                                                <%= if team_member do %>
                                                <%= format_team_member(team_member.user) %>
                                                    <% else %>
                                                <%= format_phone(message.phone_number) %>
                                                    <% end %>
                                                ·
                                                <%= format_date(message.sent_at) %>
                                                <%= if message.read && @open_conversation.channel_type=="APP" do %>
                                                <i class="fa fa-check" style="color: green"></i>
                                                <i class="fa fa-check" style="color: green"></i>
                                                <% end %>
                                            </div>
                                            <% end %>
                                        </div>
                                    </li>
                                    <% end %>
                        <% end %>

                    <% end %>

                <% end %>
                                    <%= live_render(@socket, MainWeb.Live.ConversationMessageUpdatesView, session: %{"user" => @user, "conversation" => @open_conversation.id } ,id: "update"<>@open_conversation.id<>to_string(assigns[:child_id])) %>
                                    <%= if assigns[:typing] do %>
                                    <li class="conversation-inbound">
                                        <div class="conversation-meta">
                                            <p class="ticontainer"><span>User is typing </span>
                                                <span class="tiblock">
                                                <span class="tidot"></span>
                                                <span class="tidot"></span>
                                                <span class="tidot"></span>
                                                </span>
                                            </p>
                                        </div>
                                    </li>
                                    <% end %>
                                </ul><!-- /.conversation-list -->
                            </div><!-- /.conversations -->

                        </div><!-- /.card -->
                    </div><!-- /message body -->
                    <!-- message publisher -->
                    <div class="message-publisher">
                        <!-- form -->
                        <%= f = form_for @mchangeset, "#", [ phx_submit: :save] %>
                        <!-- .media -->
                        <div class="media mb-1">

                            <div class="media-body">
                                <%= text_input f, :message,
                                     id: "messagetext",
                                     class: "form-control border-0 shadow-none",
                                     place_holder: "Type a message",
                                     phx_focus: :focused,
                                     data_emojiable: true,
                                     data_tribute: true,
                                     phx_blur: :blured  %>


                            </div>
                            <div class="d-flex align-items-center">



                                <button type="submit" class="btn btn-light btn-icon"><i
                                        class="far fa-paper-plane"></i></button>
                            </div>
                        </div><!-- /.media -->
                        </form><!-- /form -->

                    </div><!-- /message publisher -->
                </div><!-- /.message -->
            </div>
            <!--Sidebar Window-->
            <div class="col-lg-4 p-0  bg-white"
                 style="    border-left: 1px solid rgba(34,34,48,.1);height: calc(100vh - 3.5rem);overflow-y:scroll;">
                <!-- .sidebar-header -->
                <header class="sidebar-header d-sm-none">
                    <ol class="breadcrumb mb-0">
                        <li class="breadcrumb-item">
                            <a class="prevent-default" href="#" onclick="Looper.toggleSidebar()"><i
                                    class="breadcrumb-icon fa fa-angle-left mr-2"></i>Back</a>
                        </li>
                    </ol>
                </header><!-- /.sidebar-header -->
                <!-- .nav-tabs -->
                <ul class="nav nav-tabs nav-fill bg-white shadow-sm border-bottom" role="tablist">
                    <li class="nav-item">
                        <a class="nav-link active" data-toggle="tab" href="#team-profile" role="tab"
                           aria-controls="team-profile" aria-selected="true">Details</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" data-toggle="tab" href="#message-files" role="tab"
                           aria-controls="message-files" aria-selected="false">Notes</a>
                    </li>
                </ul><!-- /.nav-tabs -->
                <!-- .sidebar-section-fill -->
                <div class="sidebar-section-fill">
                    <!-- Tab panes -->
                    <div class="tab-content">
                        <!-- #team-profile -->
                        <div id="team-profile" class="tab-pane fade show active" role="tabpanel"
                             aria-labelledby="team-profile">
                            <!-- .card -->
                            <div class="">
                                <!-- .card-body -->
                                <div class="card-body text-center">
                                    <!-- team avatar -->
                                    <a href="#" class="user-avatar user-avatar-xl my-3"><img
                                            src="/images/unknown-profile.jpg"></a>
                                    <!-- /team avatar -->
                                    <h3 class="card-title text-truncate">
                                        <%= if @open_conversation.member && @open_conversation.member.first_name, do: @open_conversation.member.first_name<>" "<>@open_conversation.member.last_name, else: "N/A" %>
                                    </h3>
                                    <h6 class="card-subtitle text-muted mb-3"> <%= @open_conversation.location.location_name %>
                                        || <%= if @open_conversation.member, do: format_date(@open_conversation.member.inserted_at), else: "" %></h6>
                                    <!-- grid row -->
                                </div><!-- /.card-body -->
                                <!--  <div class="card-footer">
                                      <div class="card-footer-item">
                                          Delinquent
                                          <div class="text-muted small"> Status</div>
                                      </div>
                                      <div class="card-footer-item">
                                          Basic - Single
                                          <div class="text-muted small"> Plan</div>
                                      </div>
                                  </div>


                                <div class="card-footer">
                                    <div class="card-footer-item card-footer-item-bordered">
                                        <div class="metric">
                                            <p class="metric-label mb-1"> Payment Due Date </p>
                                            <p class="metric-value"><strong> Apr 20, 2020 </strong></p>
                                        </div>
                                    </div>
                                    <div class="card-footer-item card-footer-item-bordered">
                                        <div class="metric">
                                            <p class="metric-label mb-1"> Amount Due </p>
                                            <p class="metric-value"><strong> $57.64 </strong></p>
                                        </div>
                                    </div>
                                </div>
                                <div class="card-footer">
                                    <div class="card-footer-item card-footer-item-bordered">
                                        <div class="metric">
                                            <p class="metric-label mb-1"> Last Check-In </p>
                                            <p class="metric-value"><strong> Jan 20, 2020 </strong></p>
                                        </div>
                                    </div>
                                    <div class="card-footer-item card-footer-item-bordered">
                                        <div class="metric">
                                            <p class="metric-label mb-1"> Check-In Streak </p>
                                            <p class="metric-value"><strong> 7 </strong></p>
                                        </div>
                                    </div>
                                </div> -->
                                <div class="card-footer p-3">
                                    <!-- .form -->
                                    <form id="member-form" method="PUT" style="width:100%;">
                                        <%= if @open_conversation.member do %>
                                        <input name="id" type="hidden" value="<%= @open_conversation.member.id %>">
                                        <% end %>
                                        <input name="member[team_id]" type="hidden"
                                               value="<%= @open_conversation.location.team_id %>">
                                        <fieldset>
                                            <div class="row">
                                                <div class="col-lg-12">
                                                    <div class="form-group">
                                                        <label for="email">Email</label>
                                                        <input name="member[email]" type="text" class="form-control"
                                                               value="<%= if @open_conversation.member, do: @open_conversation.member.email, else: "N/A" %>">
                                                    </div>
                                                </div>

                                            </div>
                                            <div class="row">
                                                <div class="col-lg-6">
                                                    <div class="form-group">
                                                        <label for="fl1">First Name</label>
                                                        <input name="member[first_name]" type="text"
                                                               class="form-control"
                                                               value="<%= if @open_conversation.member, do: @open_conversation.member.first_name, else: "N/A" %>">
                                                    </div>
                                                </div>
                                                <div class="col-lg-6">
                                                    <div class="form-group">
                                                        <label for="fl1">Last Name</label>
                                                        <input name="member[last_name]" type="text" class="form-control"
                                                               value="<%= if @open_conversation.member, do: @open_conversation.member.last_name, else: "N/A" %>">
                                                    </div>
                                                </div>

                                            </div><!-- /.form-group -->
                                            <div class="row">


                                                <div class="col-lg-6">
                                                    <div class="form-group">
                                                        <label for="fl1">Phone Number</label>
                                                        <input name="member[phone_number]" type="text"
                                                               class="form-control"
                                                               value="<%= if @open_conversation.member, do: format_phone(@open_conversation.member.phone_number), else: "N/A" %>">
                                                    </div>
                                                </div>
                                                <div class="col-lg-6">
                                                    <div class="form-group">
                                                        <label for="fl1">Location</label>
                                                        <input type="text" class="form-control"
                                                               value="<%= @open_conversation.location.location_name %>"
                                                               readonly>
                                                    </div>
                                                </div>
                                            </div><!-- /.form-group -->
                                            <div class="form-group">
                                                <!-- .control-label -->
                                                <label class="control-label" for="select2-tagging">Status</label>
                                                <!-- you can put options directly in data attribute -->
                                                <select id="member-status" name="member[status]" class="form-control">
                                                    <%= for {key, value} <- member_status() do %>
                                                    <%= if @open_conversation.member && @open_conversation.member.status == value do %>
                                                    <option value="<%= value %>" selected><%= key %></option>
                                                    <% else %>
                                                    <option value="<%= value %>"><%= key %></option>
                                                    <% end %>
                                                    <% end %>
                                                </select>
                                            </div>


                                        </fieldset>
                                        <button class="btn btn-primary btn-lg btn-block" id="update_member">Update</button>

                                    </form>

                                    <!-- .fieldset -->
                                    <!-- /.form-group -->
                                    <!-- .form-group -->

                                </div><!-- /.card-footer -->

                            </div><!-- /.card -->
                            <!-- .list-group -->

                        </div><!-- /#team-profile -->
                        <!-- #message-files -->
                        <div id="message-files" class="tab-pane fade" role="tabpanel" aria-labelledby="message-files">
                            <div class="card-body border-top" style="overflow-y:scroll;z-index: 2;max-height: 65vh;">
                                <ul class="timeline timeline-fluid p-0">
                                    <%= for n <- @notes do %>
                                    <!-- .timeline-item -->
                                    <li class="timeline-item py-2">

                                        <!-- .timeline-body -->
                                        <div class="timeline-body m-0">
                                            <!-- .media -->
                                            <div class="media">
                                                <!-- .media-body -->
                                                <div class="media-body">
                                                    <p class="mb-0">
                                                        <%= n.user.first_name %> <%= n.user.last_name %>
                                                        : <%= text_to_html(n.text,[escape: false]) |> safe_to_string |> raw %>
                                                    </p><span
                                                        class="timeline-date"><%= format_date(n.inserted_at) %></span>
                                                </div><!-- /.media-body -->
                                            </div><!-- /.media -->
                                        </div><!-- /.timeline-body -->
                                    </li><!-- /.timeline-item -->
                                    <% end %>

                                </ul><!-- /.timeline -->
                            </div>
                            <div class="card-footer p-3 bg-white"
                                 style="position: absolute;width:100%;bottom:0;z-index:10000;">
                                <!-- .form -->
                                <%= f = form_for :foo, "#", [ phx_submit: :new_note, style: "width:100%;"] %>
                                <!-- .fieldset -->
                                <fieldset>
                                    <div class="form-group">
                                        <label for="tf6">Private Note</label>
                                        <%= textarea f, :text, prompt: "Enter Notes", id: "tag_user", rows: "3", class: "form-control"  %>
                                    </div>

                                </fieldset><!-- /.fieldset -->
                                <button type="submit" class="btn btn-primary btn-lg btn-block" type="submit">Add
                                </button>
                                </form><!-- /.form -->

                            </div><!-- /.card-footer -->
                        </div><!-- /#message-files -->
                    </div><!-- /Tab panes -->
                </div>
            </div>
            <% else %>
                    No conversations to display
            <% end%>

        </div>
    </div>

</div>
<div class="modal fade" id="newMsg" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle"
     aria-hidden="true" >
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLongTitle">Send a Message</h5>

                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <%= f = form_for @changeset, "#", [ phx_submit: :new_msg,  novalidate: :novalidate] %>
                <fieldset>
                        <div class="form-group">
                            <label for="locationMsg">Location</label>
                            <select id="locationMsg"
                                    name="location_id"
                                    class="form-control select2-hidden-accessible"
                                    data-placeholder="Select a Location"
                                    data-toggle="select2"
                                    data-allow-clear="true"
                                    data-select2-id="locationMsg" tabindex="-1"
                                    aria-hidden="true">
                                <%= for l <- @locations do %>
                                    <option value="<%= l.id %>"> <%= l.location_name %></option>
                                <% end %>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="unknown">To</label>
                            <%= text_input f, :original_number, class: "form-control" %>
                        </div>
                        <div class="form-group">
                            <label for="tf6">Message</label>
                            <%= textarea f, :message, class: "form-control", place_holder: "Type a message", rows: 5, id: "tf6" %>
                        </div>
                    </fieldset>

                <button type="submit" class="btn btn-primary float-right" >Send</button>
                <button type="button" class="btn btn-secondary float-right" data-dismiss="modal">Cancel</button>
                </div>
            </div>
        </div>
    </div>
</div>
<div style="display: none" id="availableTags">

    <%= for saved_reply <- @saved_replies do %>
    <p><span><%= saved_reply.draft %></span><span><%= saved_reply.title %></span></p>
    <% end %>
</div>
<div style="display: none" id="availableMembers">

    <%= for x <- @team_members do %>
    <p><span><%= x.id %></span><span><%= x.user.first_name <> " " <> x.user.last_name %></span></p>
    <% end %>
</div>
<style>
    .log-divider > span {
        z-index: 1 !important;
    }

    @media (min-width: 1200px) {
        .has-compact-menu .has-sidebar-expand-xl.has-sidebar-fluid .page-inner {
            margin-right: calc(100vw - 24.5rem) !important;
        }

        .has-compact-menu .has-sidebar-expand-xl.has-sidebar-fluid .page-sidebar {
            width: calc(100vw - 24.5rem) !important;
            max-width: calc(100vw - 24.5rem) !important;
        }

    }
</style>
