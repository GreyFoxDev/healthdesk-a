<tr>
    <% team_member = (@c.team_member || default_user()) %>
    <td>
        <span class="user-avatar-wrapper">
            <a href="#" class="user-avatar user-avatar-md"><img src="<%= team_member.user.avatar %>" alt=""></a>
            <span>
                <b>
                    <a href="<%= team_location_conversation_conversation_message_path(@conn, :index, @location.team_id, @location.id, @c.id) %>">
                        <%= if !@c.team_member do %>
                            <%=  format_phone(@c.original_number) |> format_assigned() %>
                        <% else %>
                            <%= team_member.user.first_name %> <%= team_member.user.last_name %>
                        <% end %>
                    </a>
                </b>
                <span class="list-group-item-text"><%= String.replace(team_member.user.role, "-", " ") |> String.capitalize() %></span>
            </span>
        </span>
    </td>
    <td>

        <%= if @c.member && @c.member.first_name do %>
            <b><a href="<%= team_location_conversation_conversation_message_path(@conn, :index, @location.team_id, @location.id, @c.id) %>"><%= Enum.join([@c.member.first_name, @c.member.last_name], " ") %></a></b>
        <% else %>
            <b><a href="<%= team_location_conversation_conversation_message_path(@conn, :index, @location.team_id, @location.id, @c.id) %>"><%= format_phone(@c.original_number) %></a></b>
        <% end %>
        <p class="list-group-item-text"><%= List.first(@c.conversation_messages).message |> String.slice(0..100) %>&hellip;</p>
    </td>
    <td>
        <%= List.first(@c.conversation_messages).sent_at |> format_date() %>
    </td>
    <td>
        <div class="dropdown">
            <%= if @c.status == "closed" do %>
            <button class="btn btn-sm btn-secondary btn-icon dropdown-toggle hide-arrow" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                ...
            </button>
            <div id="open-close-conversation" class="dropdown-menu dropdown-menu-right" aria-labelledby="dropdownMenuButton">
                <%= link("Open", class: "dropdown-item",
                        to: team_location_conversation_conversation_path(@conn, :open, @location.team_id, @location.id, @c.id),
                        method: :put) %>
            </div>
            <%  end %>
            <%= if @c.status != "closed" do %>
                <%= if @dispositions != [] do %>
                    <button type="button" class="btn btn-sm btn-secondary btn-icon dropdown-toggle hide-arrow" data-toggle="modal" data-target="#exampleModalScrollable">...</button>
                      <!-- Modal -->
                    <div class="modal fade" id="exampleModalScrollable" tabindex="-1" role="dialog" aria-labelledby="exampleModalScrollableTitle" aria-hidden="true">
                    <div class="modal-dialog modal-dialog-scrollable modal-dialog-centered" role="document">
                        <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="exampleModalScrollableTitle">Close Conversation</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            <div class="form-group">
                                <div class="form-label-group">
                                    <%= for {key, value} <- @dispositions do %>
                                        <%= link(key, class: "dropdown-item", to: team_location_conversation_conversation_path(@conn, :close, @location.team_id, @location.id, @c.id, disposition_id: value), method: :put) %>
                                    <% end %>
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                        </div>
                        </div>
                    </div>
                    </div>
                <% else %>
                <button class="btn btn-sm btn-secondary btn-icon dropdown-toggle hide-arrow" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">...</button>
                    <div id="open-close-conversation" class="dropdown-menu dropdown-menu-right" aria-labelledby="dropdownMenuButton">
                        <%= link("Close", class: "dropdown-item", to: team_location_conversation_conversation_path(@conn, :close, @location.team_id, @location.id, @conversation.id), method: :put) %>
                    </div>
                <% end %>
            <% end %>
        </div>
        </div>
    </td>
</tr>
